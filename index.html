<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Devagneya's World ‚Äî GreenCityProject</title>
  <style>
/* --- STYLES.CSS START --- */
/* Base */
:root{--bg1:#aee1f9;--bg2:#fefefe}
*{box-sizing:border-box}
body{margin:0;overflow:hidden;background:linear-gradient(var(--bg1),var(--bg2));height:100vh;font-family:Georgia,serif;color:#222}

/* Parallax layers */
.layer{position:absolute;width:200%;height:100%;background-repeat:repeat-x;background-size:cover}
.sky{background:linear-gradient(var(--bg1),var(--bg2));z-index:1}
.clouds{background-image:url('clouds-layer.png');animation:moveClouds 60s linear infinite;z-index:2}
.mountains{background-image:url('mountains-layer.png');animation:moveMountains 120s linear infinite;z-index:3}
@keyframes moveClouds{from{transform:translateX(0)}to{transform:translateX(-50%)}}
@keyframes moveMountains{from{transform:translateX(0)}to{transform:translateX(-25%)}}

/* Floating */
.leaf,.lantern{position:absolute;width:80px;height:80px;background-size:contain;background-repeat:no-repeat;animation:floaty 6s ease-in-out infinite;z-index:4}
.leaf{background-image:url('leaf.png');top:40%;left:20%}
.lantern{background-image:url('lantern.png');top:60%;left:70%;animation-delay:2s}
@keyframes floaty{0%{transform:translateY(0)}50%{transform:translateY(-15px)}100%{transform:translateY(0)}}

/* Hero */
.hero{position:absolute;top:16%;left:50%;transform:translateX(-50%);text-align:center;z-index:6}
.hero-title{margin:0;font-size:3rem;letter-spacing:0.6px}
.hero-sub{margin:6px 0 0;color:#444;font-size:1.05rem}
/* Hero section text colors - Ghibli aesthetic */
.hero-title {
  color: #ffffff;
  text-shadow: 0 2px 6px rgba(0,0,0,0.4);
  font-family: 'Papyrus', 'Comic Sans MS', cursive, sans-serif;
}

.hero-sub {
  color: #2ecc71;
  text-shadow: 0 1px 4px rgba(0,0,0,0.3);
  font-family: 'Papyrus', 'Comic Sans MS', cursive, sans-serif;
}

/* Controls */
#musicToggle{position:absolute;top:20px;right:20px;z-index:10;padding:10px 14px;border-radius:8px;background:rgba(255,255,255,0.9);border:none;cursor:pointer}
#projectsBtn,#carsBtn{position:absolute;top:20px;z-index:10;padding:10px 12px;border-radius:8px;background:rgba(255,255,255,0.92);border:none;cursor:pointer}
#projectsBtn{left:20px} #carsBtn{left:140px}

/* Modal */
.modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:60}
.panel{background:#fff;padding:18px;border-radius:12px;max-width:760px;width:94%;box-shadow:0 12px 40px rgba(0,0,0,0.12);max-height:80vh;overflow:auto}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
label{display:block;margin-bottom:6px}
input[type="text"],input[type="url"],input[type="password"],input[type="file"]{width:100%;padding:8px;border-radius:8px;border:1px solid #ddd}
.actions{display:flex;gap:8px;margin-top:10px}
button.small{padding:8px 10px;border-radius:8px;border:none;background:#f0f0f0;cursor:pointer}

/* Project/Car list */
.projects-list{margin-top:12px}
.project-item{display:flex;gap:10px;align-items:center;padding:8px;border-radius:8px;background:rgba(0,0,0,0.03);margin-bottom:8px}
.thumb{width:64px;height:48px;background:#fafafa;border-radius:6px;display:flex;align-items:center;justify-content:center;overflow:hidden}
.thumb img{width:100%;height:100%;object-fit:cover}
.meta{flex:1}
.meta strong{display:block}
.meta small{color:#666}
.project-actions{display:flex;gap:6px}

/* Home video */
.home-video{position:absolute;left:50%;top:46%;transform:translateX(-50%);width:min(88vw,960px);z-index:6}
.video-wrapper{display:flex;flex-direction:column;gap:12px}

/* MODIFIED: .video-block now holds the poster and play button */
.video-block{
  position:relative;
  padding-bottom:56.25%; /* 16:9 aspect ratio */
  height:0;
  overflow:hidden;
  border-radius:12px;
  box-shadow:0 10px 30px rgba(0,0,0,0.12);
  background:#000;
  background-size: cover;
  background-position: center;
}
/* This holds the iframe *after* it's loaded */
.video-block iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:0;border-radius:12px}

/* NEW: Play button styled to be large and centered */
#videoPlayBtn {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 10;
  background: rgba(0, 0, 0, 0.5);
  border: 2px solid white;
  border-radius: 50%;
  width: 70px;
  height: 70px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}
#videoPlayBtn:hover {
  background: rgba(0, 0, 0, 0.7);
  transform: translate(-50%, -50%) scale(1.1);
}
/* SVG play icon */
#videoPlayBtn svg {
  width: 30px;
  height: 30px;
  fill: white;
  margin-left: 5px; /* Optical centering */
}
/* REMOVED: .video-controls are no longer needed */
.video-controls { display: none; }
/* REMOVED: .video-fallback is no longer needed */
.video-fallback { display: none; }

/* Lightbox tweaks */
.car-link{color:#222;text-decoration:underline;font-size:0.95rem;display:inline-block;margin-top:8px}

/* Responsive */
@media (max-width:640px){
  .grid{grid-template-columns:1fr}
  .hero-title{font-size:2.4rem}
  .home-video{width:94vw;top:52%}
}
/* --- STYLES.CSS END --- */
  </style>
</head>
<body>
  <!-- Parallax layers -->
  <div class="layer sky" aria-hidden="true"></div>
  <div class="layer clouds" aria-hidden="true"></div>
  <div class="layer mountains" aria-hidden="true"></div>

  <!-- Floating foreground -->
  <div class="leaf" aria-hidden="true"></div>
  <div class="lantern" aria-hidden="true"></div>

<header class="hero">
  <h1 class="hero-title">Devagneya's World</h1>
  <p class="hero-sub">Featured ‚Äî GreenCityProject</p>
</header>

  <!-- Home video block with robust fallback -->
  <section class="home-video" aria-label="GreenCityProject featured video">
    <div id="videoWrapper" class="video-wrapper">
      
      <!-- MODIFIED: Video block now contains the play button. The iframe will be added here by JS -->
      <div id="videoBlock" class="video-block" role="button" tabindex="0" aria-label="Play GreenCityProject video">
        
        <!-- NEW: Large, centered play button -->
        <button id="videoPlayBtn" aria-label="Play video">
          <svg viewBox="0 0 100 100">
            <polygon points="30,20 80,50 30,80"></polygon>
          </svg>
        </button>

      </div>

      <!-- REMOVED: Fallback card is no longer needed -->
      <!-- REMOVED: Old video controls are no longer needed -->
    </div>

  </section>

  <!-- Top controls -->
  <button id="musicToggle" aria-pressed="false">üîà Music On</button>
  <button id="projectsBtn" aria-haspopup="dialog" aria-controls="projectsModal">üìÅ Projects</button>
  <button id="carsBtn" aria-haspopup="dialog" aria-controls="carsModal">üöó Fav Cars</button>

  <!-- Background music -->
  <audio id="bgMusic" src="Moonlight.mp3" loop preload="auto"></audio>

  <!-- Projects Modal (parent gated) -->
  <div id="projectsModal" class="modal" style="display:none" role="dialog" aria-modal="true" aria-labelledby="projectsTitle">
    <div class="panel" role="document">
      <h3 id="projectsTitle">Projects (Parent access)</h3>
      <div id="pinGate">
        <label for="parentPin">Parent PIN</label>
        <input id="parentPin" type="password" inputmode="numeric" aria-label="Parent PIN" />
        <div class="actions">
          <button id="pinSubmit" class="small">Unlock</button>
          <button id="pinClose" class="small">Close</button>
        </div>
      </div>
      <div id="projectsContent" style="display:none">
        <p>Upload image or PDF, or paste a project link. Saved locally in this browser only.</p>
        <div class="grid">
          <div>
            <label for="fileInput">Upload file</label>
            <input id="fileInput" type="file" accept="image/*,application/pdf" />
          </div>
          <div>
            <label for="linkInput">Project link</label>
            <input id="linkInput" type="url" placeholder="https://example.com" />
          </div>
        </div>
        <div class="actions">
          <button id="saveFile" class="small">Save File</button>
          <button id="saveLink" class="small">Save Link</button>
          <button id="closePanel" class="small">Done</button>
        </div>
        <div id="projectsList" class="projects-list" aria-live="polite"></div>
      </div>
    </div>
  </div>

  <!-- Fav Cars Modal (parent gated) -->
  <div id="carsModal" class="modal" style="display:none" role="dialog" aria-modal="true" aria-labelledby="carsTitle">
    <div class="panel" role="document">
      <h3 id="carsTitle">Fav Cars (Parent access)</h3>
      <div id="carsPinGate">
        <label for="carsPin">Parent PIN</label>
        <input id="carsPin" type="password" inputmode="numeric" aria-label="Parent PIN for cars" />
        <div class="actions">
          <button id="carsPinSubmit" class="small">Unlock</button>
          <button id="carsPinClose" class="small">Close</button>
        </div>
      </div>
      <div id="carsContent" style="display:none">
        <p>Add car: image, name, note, optional link. Saved locally.</p>
        <div class="grid">
          <div><label for="carFile">Car image</label><input id="carFile" type="file" accept="image/*" /></div>
          <div><label for="carName">Name</label><input id="carName" type="text" /></div>
          <div><label for="carNote">Note</label><input id="carNote" type="text" /></div>
          <div><label for="carLink">Link</label><input id="carLink" type="url" /></div>
        </div>
        <div class="actions">
          <button id="saveCar" class="small">Save Car</button>
          <button id="doneCars" class="small">Done</button>
        </div>
        <div id="carsList" class="projects-list" aria-live="polite"></div>
      </div>
    </div>
  </div>

  <!-- Car Lightbox -->
  <div id="carLightbox" class="modal" style="display:none" role="dialog" aria-modal="true">
    <div class="panel" style="max-width:820px">
      <button id="closeLightbox" class="small" style="float:right">Close</button>
      <div id="lightboxContent" style="text-align:center"></div>
    </div>
  </div>

  <!-- Message Modal -->
  <div id="messageModal" class="modal" style="display:none" role="alertdialog" aria-modal="true" aria-labelledby="messageTitle">
    <div class="panel" style="max-width:400px; text-align:center;">
      <h4 id="messageTitle" style="margin-top:0">Notice</h4>
      <p id="messageText"></p>
      <div id="messageActions" class="actions" style="justify-content:center">
        <button id="messageOK" class="small">OK</button>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div id="confirmModal" class="modal" style="display:none" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
    <div class="panel" style="max-width:400px; text-align:center;">
      <h4 id="confirmTitle" style="margin-top:0">Confirm Action</h4>
      <p id="confirmText"></p>
      <div id="confirmActions" class="actions" style="justify-content:center">
        <button id="confirmYes" class="small" style="background-color:#c0392b; color:white;">Yes, Delete</button>
        <button id="confirmNo" class="small">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Inline JS: focused, minimal -->
  <script>
  /* ---------- Music fade ---------- */
  const bg = document.getElementById('bgMusic');
  const musicBtn = document.getElementById('musicToggle');
  let musicPlaying = false, fadeTimer;
  function fadeVolume(from,to,ms,cb){ clearInterval(fadeTimer); const steps=20, step=ms/steps; let i=0; bg.volume=Math.max(0,Math.min(1,from)); fadeTimer=setInterval(()=>{ i++; bg.volume = from + (to-from)*(i/steps); if(i>=steps){ clearInterval(fadeTimer); if(cb) cb(); } }, step); }
  document.body.addEventListener('click', function once(){ document.body.removeEventListener('click', once); bg.volume=0; bg.play().catch(()=>{}); fadeVolume(0,0.35,1200); musicPlaying=true; musicBtn.textContent='üîà Music On'; musicBtn.setAttribute('aria-pressed','true'); }, {once:true});
  musicBtn.addEventListener('click', ()=>{ if(musicPlaying){ fadeVolume(bg.volume,0,800,()=>bg.pause()); musicBtn.textContent='üîá Music Off'; musicBtn.setAttribute('aria-pressed','false'); } else { bg.currentTime = bg.currentTime || 0; bg.play().catch(()=>{}); fadeVolume(0,0.35,1000); musicBtn.textContent='üîà Music On'; musicBtn.setAttribute('aria-pressed','true'); } musicPlaying = !musicPlaying; });

  /* ---------- Custom Modals (Replacing alert/confirm) ---------- */
  const messageModal = document.getElementById('messageModal');
  const messageText = document.getElementById('messageText');
  const messageOK = document.getElementById('messageOK');

  function showMessage(title, message) {
    document.getElementById('messageTitle').textContent = title;
    messageText.textContent = message;
    messageModal.style.display = 'flex';
    messageOK.onclick = () => messageModal.style.display = 'none';
  }

  const confirmModal = document.getElementById('confirmModal');
  const confirmText = document.getElementById('confirmText');
  const confirmYes = document.getElementById('confirmYes');
  const confirmNo = document.getElementById('confirmNo');
  let confirmCallback = null;

  function showConfirm(message, callback) {
    confirmText.textContent = message;
    confirmCallback = callback;
    confirmModal.style.display = 'flex';
  }

  confirmYes.addEventListener('click', () => {
    confirmModal.style.display = 'none';
    if (confirmCallback) confirmCallback(true);
  });

  confirmNo.addEventListener('click', () => {
    confirmModal.style.display = 'none';
    if (confirmCallback) confirmCallback(false);
  });

  /* ---------- Projects (lightweight local) ---------- */
  (function(){
    const PIN='1234';
    const projectsBtn=document.getElementById('projectsBtn');
    const projectsModal=document.getElementById('projectsModal');
    const pinGate=document.getElementById('pinGate');
    const projectsContent=document.getElementById('projectsContent');
    const parentPinInput=document.getElementById('parentPin');
    const saveFileBtn=document.getElementById('saveFile');
    const saveLinkBtn=document.getElementById('saveLink');
    const closePanel=document.getElementById('closePanel');
    const fileInput=document.getElementById('fileInput');
    const linkInput=document.getElementById('linkInput');
    const projectsList=document.getElementById('projectsList');

    function open(){ projectsModal.style.display='flex'; parentPinInput.focus(); }
    function close(){ projectsModal.style.display='none'; }
    projectsBtn.addEventListener('click', open);
    document.getElementById('pinClose').addEventListener('click', close);
    closePanel.addEventListener('click', close);

    document.getElementById('pinSubmit').addEventListener('click', ()=> {
      if(parentPinInput.value===PIN){ pinGate.style.display='none'; projectsContent.style.display='block'; load(); } else { showMessage('Error', 'Incorrect Parent PIN. Please try again.'); parentPinInput.focus(); }
    });

    function get(){ try{return JSON.parse(localStorage.getItem('devagneya_projects')||'[]')}catch(e){return[]} }
    function set(v){ localStorage.setItem('devagneya_projects', JSON.stringify(v)) }

    saveFileBtn.addEventListener('click', ()=> {
      const f=fileInput.files[0]; if(!f){ showMessage('Missing File', 'Please choose a file to upload.'); return; } const r=new FileReader();
      r.onload=function(e){ const data=e.target.result; const proj={id:Date.now(),kind:'file',name:f.name,mime:f.type,data}; const list=get(); list.unshift(proj); set(list); fileInput.value=''; load(); };
      r.readAsDataURL(f);
    });

    saveLinkBtn.addEventListener('click', ()=> {
      const url = linkInput.value.trim(); if(!url){ showMessage('Missing URL', 'Please enter a project link URL.'); return; }
      try{ const u=new URL(url); const proj={id:Date.now(),kind:'link',name:u.hostname+u.pathname,url:u.href}; const list=get(); list.unshift(proj); set(list); linkInput.value=''; load(); }catch(e){ showMessage('Invalid URL', 'The link you entered is not a valid URL.'); }
    });

    function load(){
      const list=get(); projectsList.innerHTML=''; if(list.length===0){ projectsList.innerHTML='<div>No projects yet</div>'; return; }
      list.forEach(p=>{ const item=document.createElement('div'); item.className='project-item'; const thumb=document.createElement('div'); thumb.className='thumb';
        if(p.kind==='file' && p.mime.startsWith('image/')){ const img=document.createElement('img'); img.src=p.data; img.alt=p.name; thumb.appendChild(img); }
        else if(p.kind==='file' && p.mime==='application/pdf'){ thumb.innerHTML='<small>PDF</small>'; }
        else if(p.kind==='link'){ thumb.innerHTML='<small>LINK</small>'; }
        const meta=document.createElement('div'); meta.className='meta'; const title=document.createElement('strong'); title.textContent=p.name||p.url; const sub=document.createElement('small'); sub.textContent=p.kind==='link'?p.url:p.mime||''; meta.appendChild(title); meta.appendChild(sub);
        const actions=document.createElement('div'); actions.className='project-actions';
        if(p.kind==='link'){ const open=document.createElement('button'); open.className='small'; open.textContent='Open'; open.addEventListener('click', ()=>window.open(p.url,'_blank')); actions.appendChild(open); }
        else if(p.kind==='file'){ const open=document.createElement('button'); open.className='small'; open.textContent='Open'; open.addEventListener('click', ()=>{ const w=window.open(); if(w){ w.document.write(`<title>${p.name}</title>`); if(p.mime.startsWith('image/')) w.document.write(`<img src="${p.data}" style="max-width:100%;">`); else w.document.write(`<iframe src="${p.data}" style="width:100%;height:100vh;border:none"></iframe>`); w.document.close(); } else { showMessage('Popup Blocked', 'Please allow popups in your browser to preview the file.'); } }); actions.appendChild(open); }
        const del=document.createElement('button'); del.className='small'; del.textContent='Delete'; del.addEventListener('click', ()=>{ showConfirm(`Are you sure you want to permanently delete project: ${p.name}?`, (confirmed) => { if (confirmed) { const rem=get().filter(x=>x.id!==p.id); set(rem); load(); } }); }); actions.appendChild(del);
        item.appendChild(thumb); item.appendChild(meta); item.appendChild(actions); projectsList.appendChild(item);
      });
    }
    projectsModal.addEventListener('click', (e)=>{ if(e.target===projectsModal) close(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && projectsModal.style.display==='flex') close(); });
  })();

  /* ---------- Fav Cars (local) ---------- */
  (function(){
    const PIN='1234';
    const carsBtn=document.getElementById('carsBtn');
    const carsModal=document.getElementById('carsModal');
    const carsPinGate=document.getElementById('carsPinGate');
    const carsContent=document.getElementById('carsContent');
    const carFile=document.getElementById('carFile');
    const carName=document.getElementById('carName');
    const carNote=document.getElementById('carNote');
    const carLink=document.getElementById('carLink');
    const saveCar=document.getElementById('saveCar');
    const doneCars=document.getElementById('doneCars');
    const carsList=document.getElementById('carsList');
    const carLightbox=document.getElementById('carLightbox');
    const lightboxContent=document.getElementById('lightboxContent');

    function open(){ carsModal.style.display='flex'; carsPinGate.querySelector('input').focus(); }
    function close(){ carsModal.style.display='none'; }
    carsBtn.addEventListener('click', open);
    document.getElementById('carsPinClose').addEventListener('click', close);
    doneCars.addEventListener('click', close);

    document.getElementById('carsPinSubmit').addEventListener('click', ()=>{
      const v=document.getElementById('carsPin').value;
      if(v===PIN){ carsPinGate.style.display='none'; carsContent.style.display='block'; loadCars(); } else { showMessage('Error', 'Incorrect Parent PIN. Please try again.'); document.getElementById('carsPin').focus(); }
    });

    function get(){ try{return JSON.parse(localStorage.getItem('fav_cars')||'[]')}catch(e){return[]} }
    function set(v){ localStorage.setItem('fav_cars', JSON.stringify(v)) }

    saveCar.addEventListener('click', ()=>{
      const f=carFile.files[0]; const name=carName.value.trim()||'Untitled'; const note=carNote.value.trim(); const link=carLink.value.trim();
      if(!f){ showMessage('Missing Image', 'Please choose an image for the car.'); return; } const r=new FileReader();
      r.onload=function(e){ const data=e.target.result; const car={id:Date.now(),name, note, link, data}; const list=get(); list.unshift(car); set(list); carFile.value=''; carName.value=''; carNote.value=''; carLink.value=''; loadCars(); };
      r.readAsDataURL(f);
    });

    function loadCars(){ const list=get(); carsList.innerHTML=''; if(!list.length){ carsList.innerHTML='<div>No favourite cars yet.</div>'; return; } list.forEach(c=>{ const item=document.createElement('div'); item.className='project-item car-item'; const thumb=document.createElement('div'); thumb.className='thumb'; const img=document.createElement('img'); img.src=c.data; img.alt=c.name; thumb.appendChild(img); const meta=document.createElement('div'); meta.className='meta car-meta'; const title=document.createElement('strong'); title.textContent=c.name; const s=document.createElement('small'); s.textContent=c.note||''; meta.appendChild(title); meta.appendChild(s); const actions=document.createElement('div'); actions.className='project-actions'; const view=document.createElement('button'); view.className='small'; view.textContent='View'; view.addEventListener('click', ()=>openLightbox(c)); actions.appendChild(view); if(c.link){ const go=document.createElement('button'); go.className='small'; go.textContent='Open'; go.addEventListener('click', ()=>window.open(c.link,'_blank')); actions.appendChild(go); } const del=document.createElement('button'); del.className='small'; del.textContent='Delete'; del.addEventListener('click', ()=>{ showConfirm(`Are you sure you want to permanently delete car: ${c.name}?`, (confirmed) => { if (confirmed) { const rem=get().filter(x=>x.id!==c.id); set(rem); loadCars(); } }); }); actions.appendChild(del); item.appendChild(thumb); item.appendChild(meta); item.appendChild(actions); carsList.appendChild(item); }); }

    function openLightbox(car){ lightboxContent.innerHTML=''; const h=document.createElement('h3'); h.textContent=car.name; const img=document.createElement('img'); img.src=car.data; img.style.maxWidth='100%'; const p=document.createElement('p'); p.textContent=car.note||''; lightboxContent.appendChild(h); lightboxContent.appendChild(img); lightboxContent.appendChild(p); if(car.link){ const a=document.createElement('a'); a.href=car.link; a.target='_blank'; a.className='car-link'; a.textContent='Open link'; lightboxContent.appendChild(a);} carLightbox.style.display='flex'; }

    document.getElementById('closeLightbox').addEventListener('click', ()=> carLightbox.style.display='none');
    carLightbox.addEventListener('click', (e)=>{ if(e.target===carLightbox) carLightbox.style.display='none'; });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ carLightbox.style.display='none'; carsModal.style.display='none'; } });
  })();

  /* ---------- NEW: Home video "Click-to-Load" logic ---------- */
  (function(){
    const vidId = 'yR0N1ZnidPI';
    const videoBlock = document.getElementById('videoBlock');
    const playBtn = document.getElementById('videoPlayBtn');
    
    // 1. Find and set the thumbnail for the background
    const candidates=[
      `https://img.youtube.com/vi/${vidId}/maxresdefault.jpg`,
      `https://img.youtube.com/vi/${vidId}/hqdefault.jpg`,
      `https://img.youtube.com/vi/${vidId}/sddefault.jpg`,
      `https://img.youtube.com/vi/${vidId}/mqdefault.jpg`
    ];
    const localFallback = 'poster-fallback.jpg'; // A local fallback just in case

    async function findWorkingThumbnail(urls){
      for(const u of urls){
        try{
          const res = await fetch(u, { method:'GET', cache:'no-store' });
          if(res.ok){
            const blob = await res.blob();
            if(blob.size > 2000) return URL.createObjectURL(blob); // Found a good thumbnail
          }
        }catch(e){
          // console.warn('Thumbnail fetch failed:', u);
        }
      }
      return null; // No thumbnail found
    }

    (async function applyThumbnail(){
      const url = await findWorkingThumbnail(candidates);
      if (url) {
        videoBlock.style.backgroundImage = `url(${url})`;
      } else {
        videoBlock.style.backgroundImage = `url(${localFallback})`; // Use local fallback
      }
    })();

    // 2. Click-to-load
    function loadVideo() {
      // Clear the block (remove play button)
      videoBlock.innerHTML = ''; 
      
      // Create and add the iframe
      const iframe = document.createElement('iframe');
      iframe.src = `https://www.youtube.com/embed/${vidId}?enablejsapi=1&rel=0&modestbranding=1&autoplay=1`;
      iframe.title = "GreenCityProject";
      iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
      iframe.allowFullscreen = true;
      videoBlock.appendChild(iframe);
    }
    
    playBtn.addEventListener('click', loadVideo);
    videoBlock.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        loadVideo();
      }
    });

  })();

  /* ---------- Generic modal helpers (updated to include new modals) ---------- */
  document.addEventListener('click', (e) => {
    document.querySelectorAll('.modal').forEach(m => { if (m.style.display==='flex' && e.target===m) m.style.display='none'; });
  });
  document.addEventListener('keydown', (e) => { 
    if (e.key==='Escape'){
      document.querySelectorAll('.modal').forEach(m => { m.style.display='none'; });
    }
  });
  </script>
</body>

</html>
